#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const SVGOptimizer = require('./build-svg-optimizer');

/**
 * Static Files Copier
 *
 * Copies static files from static/ to docs/ during build
 */

class StaticCopier {
	constructor() {
		this.sourceDir = path.resolve('static');
		this.destDir = path.resolve('docs');
		this.svgOptimizer = new SVGOptimizer();
	}

	run() {
		console.log('\x1b[44m\x1b[37m BUILD \x1b[0m Copying static files...');

		try {
			// Copy individual non-SVG files (excluding site.webmanifest as it's generated by favicon builder)
			const filesToCopy = ['robots.txt', 'sitemap.xml', '.nojekyll'];
			filesToCopy.forEach((file) => {
				const src = path.join(this.sourceDir, file);
				const dest = path.join(this.destDir, file);

				if (fs.existsSync(src)) {
					fs.copyFileSync(src, dest);
					console.log(`  \x1b[42m\x1b[30m COPY \x1b[0m ${file}`);
				} else {
					console.log(`  \x1b[43m\x1b[30m INFO \x1b[0m ${file} not found`);
				}
			});

			// Optimize and copy SVG files
			this.svgOptimizer.optimizeStaticSVGs();

			// Note: site.webmanifest is now generated by build:fav directly to docs/
		} catch (error) {
			console.error('\x1b[41m\x1b[37m ERROR \x1b[0m Error copying static files:', error.message);
			process.exit(1);
		}
	}
}

// Run the copier
if (require.main === module) {
	new StaticCopier().run();
}

module.exports = StaticCopier;
